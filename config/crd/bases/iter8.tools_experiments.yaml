
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.4.1
  creationTimestamp: null
  name: experiments.iter8.tools
spec:
  group: iter8.tools
  names:
    kind: Experiment
    listKind: ExperimentList
    plural: experiments
    singular: experiment
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .status.testingPattern
      name: type
      type: string
    - jsonPath: .status.stage
      name: stage
      type: string
    - jsonPath: .status.completedLoops
      name: completed loops
      type: string
    - jsonPath: .status.message
      name: message
      type: string
    name: v2beta1
    schema:
      openAPIV3Schema:
        description: Experiment is the Schema for the experiments API
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            description: ExperimentSpec defines the desired state of Experiment
            properties:
              actions:
                additionalProperties:
                  description: Action is a slice of task specifications.
                  items:
                    description: TaskSpec contains the specification of a task.
                    properties:
                      if:
                        description: If specifies if this task should be executed.
                          Task will be evaluated if condition specified by if evaluates
                          to true, and not otherwise.
                        type: string
                      run:
                        description: Run is identifies the bash script to be run.
                          TaskSpec must include exactly one of the two fields, run
                          or task.
                        type: string
                      task:
                        description: Task uniquely identifies the task to be executed.
                          Examples include 'common/bash', etc.
                        type: string
                      with:
                        additionalProperties:
                          x-kubernetes-preserve-unknown-fields: true
                        description: With holds inputs to this task. Different task
                          require different types of inputs. Hence, this data is held
                          as json.RawMessage to be decoded by individual task libraries.
                        type: object
                    type: object
                  type: array
                description: Actions define the collections of tasks that are executed
                  by handlers. Specifically, start and finish actions are invoked
                  by start and finish handlers respectively.
                type: object
              backends:
                description: Backend is details of metrics backend or overrides to
                  a backend defined in a configmap
                items:
                  description: Backend ..
                  properties:
                    authType:
                      description: AuthType is the type of authentication used in
                        the HTTP request
                      enum:
                      - Basic
                      - Bearer
                      - APIKey
                      type: string
                    description:
                      description: Text description of the backend
                      type: string
                    headers:
                      description: Headers are key/value pairs corresponding to HTTP
                        request headers and their values. Value may be templated,
                        in which Iter8 will attempt to substitute placeholders in
                        the template at query time using Secret. Placeholder substitution
                        will be attempted only when Secret != nil.
                      items:
                        description: NamedValue name/value to be used in constructing
                          a REST query to backend metrics server
                        properties:
                          name:
                            description: Name of parameter
                            type: string
                          value:
                            description: Value of parameter
                            type: string
                        required:
                        - name
                        - value
                        type: object
                      type: array
                    jqExpression:
                      description: JQExpression defines the jq expression used by
                        Iter8 to extract the metric value from the (JSON) response
                        returned by the HTTP URL queried by Iter8. An empty string
                        is a valid jq expression.
                      type: string
                    method:
                      description: Method is the HTTP method used in the HTTP request
                      enum:
                      - GET
                      - POST
                      type: string
                    metrics:
                      description: Metrics is list of metrics available from this
                        backend
                      items:
                        description: Metric ..
                        properties:
                          authType:
                            description: AuthType is the type of authentication used
                              in the HTTP request
                            enum:
                            - Basic
                            - Bearer
                            - APIKey
                            type: string
                          body:
                            description: Body is the string used to construct the
                              (json) body of the HTTP request Body may be templated,
                              in which Iter8 will attempt to substitute placeholders
                              in the template at query time using version information.
                            type: string
                          description:
                            description: Text description of the metric
                            type: string
                          headers:
                            description: Headers are key/value pairs corresponding
                              to HTTP request headers and their values. Value may
                              be templated, in which Iter8 will attempt to substitute
                              placeholders in the template at query time using Secret.
                              Placeholder substitution will be attempted only when
                              Secret != nil.
                            items:
                              description: NamedValue name/value to be used in constructing
                                a REST query to backend metrics server
                              properties:
                                name:
                                  description: Name of parameter
                                  type: string
                                value:
                                  description: Value of parameter
                                  type: string
                              required:
                              - name
                              - value
                              type: object
                            type: array
                          jqExpression:
                            description: JQExpression defines the jq expression used
                              by Iter8 to extract the metric value from the (JSON)
                              response returned by the HTTP URL queried by Iter8.
                              An empty string is a valid jq expression.
                            type: string
                          method:
                            description: Method is the HTTP method used in the HTTP
                              request
                            enum:
                            - GET
                            - POST
                            type: string
                          name:
                            description: Name is label of metric
                            type: string
                          params:
                            description: Params are key/value pairs corresponding
                              to HTTP request parameters Value may be templated, in
                              which Iter8 will attempt to substitute placeholders
                              in the template at query time using version information.
                            items:
                              description: NamedValue name/value to be used in constructing
                                a REST query to backend metrics server
                              properties:
                                name:
                                  description: Name of parameter
                                  type: string
                                value:
                                  description: Value of parameter
                                  type: string
                              required:
                              - name
                              - value
                              type: object
                            type: array
                          provider:
                            description: Provider identifies the type of metric database.
                              Used for informational purposes.
                            type: string
                          secret:
                            description: Secret is a reference to the Kubernetes secret.
                              Secret contains data used for HTTP authentication. Secret
                              may also contain data used for placeholder substitution
                              in HeaderTemplates and URLTemplate.
                            type: string
                          type:
                            description: Type of the metric
                            enum:
                            - Counter
                            - Gauge
                            type: string
                          units:
                            description: Units of the metric. Used for informational
                              purposes.
                            type: string
                          url:
                            description: URL is a template for the URL queried during
                              the HTTP request. Typically, URL is expected to be the
                              actual URL without any placeholders. However, as indicated
                              by its name, URL may be templated. In this case, Iter8
                              will attempt to substitute placeholders in the URL at
                              query time using Secret. Placeholder substitution will
                              be attempted only when Secret != nil.
                            type: string
                          versionInfo:
                            description: VersionInfo is map of name/value pairs for
                              substitution into Body and Params
                            items:
                              additionalProperties:
                                type: string
                              type: object
                            type: array
                        required:
                        - name
                        type: object
                      type: array
                    name:
                      description: Name is label of backend
                      type: string
                    provider:
                      description: Provider identifies the type of metric database.
                        Used for informational purposes.
                      type: string
                    secret:
                      description: Secret is a reference to the Kubernetes secret.
                        Secret contains data used for HTTP authentication. Secret
                        may also contain data used for placeholder substitution in
                        HeaderTemplates and URLTemplate.
                      type: string
                    url:
                      description: URL is a template for the URL queried during the
                        HTTP request. Typically, URL is expected to be the actual
                        URL without any placeholders. However, as indicated by its
                        name, URL may be templated. In this case, Iter8 will attempt
                        to substitute placeholders in the URL at query time using
                        Secret. Placeholder substitution will be attempted only when
                        Secret != nil.
                      type: string
                    versionInfo:
                      description: VersionInfo is map of name/value pairs for substitution
                        into Body and Params
                      items:
                        additionalProperties:
                          type: string
                        type: object
                      type: array
                  required:
                  - name
                  type: object
                type: array
                x-kubernetes-preserve-unknown-fields: true
              criteria:
                description: Criteria contains a list of Criterion for assessing the
                  candidates Note that the number of rewards that can be/must be specified
                  depends on the testing pattern
                properties:
                  objectives:
                    description: Objectives is a list of conditions on metrics that
                      must be tested on each loop of the experiment. Failure of an
                      objective might reduces the likelihood that a version will be
                      selected as the winning version.
                    items:
                      description: Objective is a service level objective
                      properties:
                        lowerLimit:
                          anyOf:
                          - type: integer
                          - type: string
                          description: LowerLimit is the minimum acceptable value
                            of the metric.
                          pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                          x-kubernetes-int-or-string: true
                        metric:
                          description: Metric is the name of the metric resource that
                            defines the metric to be measured. If the value contains
                            a "/", the prefix will be considered to be a namespace
                            name. If the value does not contain a "/", the metric
                            should be defined either in the same namespace or in the
                            default domain namespace (defined as a property of iter8
                            when installed). The experiment namespace takes precedence.
                          type: string
                        upperLimit:
                          anyOf:
                          - type: integer
                          - type: string
                          description: UpperLimit is the maximum acceptable value
                            of the metric.
                          pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                          x-kubernetes-int-or-string: true
                      required:
                      - metric
                      type: object
                    type: array
                  rewards:
                    description: Rewards is a list of metrics that should be used
                      to evaluate the reward for a version in the experiment.
                    items:
                      description: Reward ..
                      properties:
                        metric:
                          description: Metric ..
                          type: string
                        preferredDirection:
                          description: PreferredDirection identifies whether higher
                            or lower values of the reward metric are preferred valid
                            values are "higher" and "lower"
                          enum:
                          - High
                          - Low
                          type: string
                      required:
                      - metric
                      - preferredDirection
                      type: object
                    type: array
                type: object
              duration:
                description: Duration describes how long the experiment will last.
                properties:
                  maxLoops:
                    description: MaxLoops is the maximum number of loops Default is
                      15 Reserved for future use
                    format: int32
                    minimum: 1
                    type: integer
                  minIntervalBetweenLoops:
                    description: IntervalSeconds is the length of an interval of the
                      experiment in seconds Default is 20 (seconds)
                    format: int32
                    minimum: 1
                    type: integer
                type: object
              metrics:
                description: Metrics are metrics definitions used by Criteria; may
                  override predefined metrics
                items:
                  description: Metric ..
                  properties:
                    authType:
                      description: AuthType is the type of authentication used in
                        the HTTP request
                      enum:
                      - Basic
                      - Bearer
                      - APIKey
                      type: string
                    body:
                      description: Body is the string used to construct the (json)
                        body of the HTTP request Body may be templated, in which Iter8
                        will attempt to substitute placeholders in the template at
                        query time using version information.
                      type: string
                    description:
                      description: Text description of the metric
                      type: string
                    headers:
                      description: Headers are key/value pairs corresponding to HTTP
                        request headers and their values. Value may be templated,
                        in which Iter8 will attempt to substitute placeholders in
                        the template at query time using Secret. Placeholder substitution
                        will be attempted only when Secret != nil.
                      items:
                        description: NamedValue name/value to be used in constructing
                          a REST query to backend metrics server
                        properties:
                          name:
                            description: Name of parameter
                            type: string
                          value:
                            description: Value of parameter
                            type: string
                        required:
                        - name
                        - value
                        type: object
                      type: array
                    jqExpression:
                      description: JQExpression defines the jq expression used by
                        Iter8 to extract the metric value from the (JSON) response
                        returned by the HTTP URL queried by Iter8. An empty string
                        is a valid jq expression.
                      type: string
                    method:
                      description: Method is the HTTP method used in the HTTP request
                      enum:
                      - GET
                      - POST
                      type: string
                    name:
                      description: Name is label of metric
                      type: string
                    params:
                      description: Params are key/value pairs corresponding to HTTP
                        request parameters Value may be templated, in which Iter8
                        will attempt to substitute placeholders in the template at
                        query time using version information.
                      items:
                        description: NamedValue name/value to be used in constructing
                          a REST query to backend metrics server
                        properties:
                          name:
                            description: Name of parameter
                            type: string
                          value:
                            description: Value of parameter
                            type: string
                        required:
                        - name
                        - value
                        type: object
                      type: array
                    provider:
                      description: Provider identifies the type of metric database.
                        Used for informational purposes.
                      type: string
                    secret:
                      description: Secret is a reference to the Kubernetes secret.
                        Secret contains data used for HTTP authentication. Secret
                        may also contain data used for placeholder substitution in
                        HeaderTemplates and URLTemplate.
                      type: string
                    type:
                      description: Type of the metric
                      enum:
                      - Counter
                      - Gauge
                      type: string
                    units:
                      description: Units of the metric. Used for informational purposes.
                      type: string
                    url:
                      description: URL is a template for the URL queried during the
                        HTTP request. Typically, URL is expected to be the actual
                        URL without any placeholders. However, as indicated by its
                        name, URL may be templated. In this case, Iter8 will attempt
                        to substitute placeholders in the URL at query time using
                        Secret. Placeholder substitution will be attempted only when
                        Secret != nil.
                      type: string
                    versionInfo:
                      description: VersionInfo is map of name/value pairs for substitution
                        into Body and Params
                      items:
                        additionalProperties:
                          type: string
                        type: object
                      type: array
                  required:
                  - name
                  type: object
                type: array
              versionInfo:
                description: VersionInfo is list of version labels
                items:
                  type: string
                minItems: 1
                type: array
            required:
            - versionInfo
            type: object
          status:
            description: ExperimentStatus defines the observed state of Experiment
            properties:
              analysis:
                description: Analysis returned by the last analyis
                properties:
                  metrics:
                    description: Metrics
                    items:
                      additionalProperties:
                        description: QuantityList ..
                        items:
                          anyOf:
                          - type: integer
                          - type: string
                          pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                          x-kubernetes-int-or-string: true
                        type: array
                      type: object
                    type: array
                  objectives:
                    description: Objectives if not empty, the length of the outer
                      slice must match the length of Spec.Versions if not empty, the
                      length of an inner slice must match the number of Spec.Criteria.Objectives
                    items:
                      description: BooleanList ..
                      items:
                        type: boolean
                      type: array
                    type: array
                  weights:
                    description: Weights if not empty, the length of the slice must
                      match the length of Spec.Versions
                    items:
                      format: int32
                      type: integer
                    type: array
                  winner:
                    description: Winner
                    properties:
                      winner:
                        description: Winner if found
                        type: string
                      winnerFound:
                        description: WinnerFound whether or not a winning version
                          has been identified
                        type: boolean
                    required:
                    - winnerFound
                    type: object
                type: object
              completedLoops:
                description: CurrentLoops is the number of loops that have completed
                  It is undefined until the experiment starts.
                format: int32
                type: integer
              conditions:
                description: List of conditions
                items:
                  description: ExperimentCondition describes a condition of an experiment
                  properties:
                    lastTransitionTime:
                      description: LastTransitionTime is the time when this condition
                        is last updated
                      format: date-time
                      type: string
                    message:
                      description: Detailed explanation on the update
                      type: string
                    reason:
                      description: Reason for the last update
                      type: string
                    status:
                      description: Status of the condition
                      type: string
                    type:
                      description: Type of the condition
                      enum:
                      - Completed
                      - Failed
                      type: string
                  required:
                  - status
                  - type
                  type: object
                type: array
              currentWeightDistribution:
                description: CurrentWeightDistribution is currently applied traffic
                  weights
                items:
                  format: int32
                  type: integer
                type: array
              lastUpdateTime:
                description: LastUpdateTime is the last time a loop has been updated
                format: date-time
                type: string
              message:
                description: Message specifies message to show in the kubectl printer
                type: string
              stage:
                description: Stage indicates where the experiment is in its process
                  of execution
                enum:
                - Initializing
                - Running
                - Finishing
                - Completed
                type: string
              startTime:
                description: StartTime is the time when the experiment is created.
                  It is set by the controller when the experiment is initialized.
                  matches
                format: date-time
                type: string
              testingPattern:
                description: TestingPattern identifies the type of experiment being
                  executed
                enum:
                - SLOValidation
                - A/B
                - A/B/N
                - Hybrid-A/B
                - Hybrid-A/B/N
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
